# generate tailwindcss
FROM node:3.16

RUN npm install -D tailwindcss
RUN NODE_ENV=production tailwindcss -c ./ui/tailwind.config.js -o ./ui/public/tailwind.css --minify


# run the app
FROM rust:1.65

# WORKDIR /api
COPY . .

ENV API_PORT=3030
ENV PORT=8080

RUN cargo install --path ./api

RUN cargo install trunk
RUN rustup target add wasm32-unknown-unknown



EXPOSE 8080

CMD api --release && trunk serve ui/index.html --release
